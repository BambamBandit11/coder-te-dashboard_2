<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coder T&E Dashboard</title>
    <!-- Updated with comprehensive Ramp API integration -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Travel & Entertainment Dashboard</h1>
        <div class="header-controls">
            <div class="system-status">
                <span id="data-freshness" class="status-indicator" title="Data freshness">üîÑ</span>
                <span id="connection-status" class="status-indicator" title="Connection status">üåê</span>
            </div>
            <span id="last-updated">Last updated: Never</span>
            <button id="refresh-btn" class="btn-primary">Refresh Data</button>
        </div>
    </header>

    <main>
        <div class="filters">
            <div class="filter-group">
                <label for="department-filter">Department:</label>
                <select id="department-filter">
                    <option value="all">All Departments</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="employee-filter">Employee:</label>
                <select id="employee-filter">
                    <option value="all">All Employees</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="month-filter">Month:</label>
                <select id="month-filter">
                    <option value="all">All Months (YTD)</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="merchant-filter">Merchant:</label>
                <select id="merchant-filter">
                    <option value="all">All Merchants</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="category-filter">Category:</label>
                <select id="category-filter">
                    <option value="all">All Categories</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="type-filter">Type:</label>
                <select id="type-filter">
                    <option value="all">All Types</option>
                    <option value="transaction">Transaction</option>
                    <option value="expense">Reimbursement</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="status-filter">Status:</label>
                <select id="status-filter">
                    <option value="all">All Statuses</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="memo-filter">Memo Search:</label>
                <input type="text" id="memo-filter" class="text-input" placeholder="Search memos...">
            </div>
            
            <div class="filter-group">
                <label for="spend-category-filter">Spend Category:</label>
                <select id="spend-category-filter">
                    <option value="all">All Spend Categories</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="spend-program-filter">Spend Program:</label>
                <select id="spend-program-filter">
                    <option value="all">All Spend Programs</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="date-from">From Date:</label>
                <input type="date" id="date-from" class="date-input">
            </div>
            
            <div class="filter-group">
                <label for="date-to">To Date:</label>
                <input type="date" id="date-to" class="date-input">
            </div>
            
            <div class="filter-group date-presets">
                <label>Quick Ranges:</label>
                <div class="preset-buttons">
                    <button type="button" class="preset-btn" data-range="last30">Last 30 Days</button>
                    <button type="button" class="preset-btn" data-range="thisquarter">This Quarter</button>
                    <button type="button" class="preset-btn" data-range="lastquarter">Last Quarter</button>
                    <button type="button" class="preset-btn" data-range="clear">Clear Dates</button>
                </div>
            </div>
        </div>

        <div class="summary-cards">
            <div class="card">
                <h3>Total YTD Spend</h3>
                <div class="amount" id="total-spend">$0.00</div>
            </div>
            <div class="card">
                <h3>This Month</h3>
                <div class="amount" id="month-spend">$0.00</div>
            </div>
            <div class="card">
                <h3>Transaction Count</h3>
                <div class="count" id="transaction-count">0</div>
            </div>
            <div class="card">
                <h3>Reimbursements</h3>
                <div class="count" id="reimbursement-count">0</div>
            </div>
            <div class="card">
                <h3>Receipts</h3>
                <div class="count" id="receipt-count">0</div>
            </div>
        </div>

        <div class="department-breakdown">
            <h2>Department Breakdown</h2>
            <div id="department-chart" class="chart-container">
                <!-- Department spending chart will be inserted here -->
            </div>
        </div>

        <div class="monthly-trend">
            <h2>Monthly Trend</h2>
            <div id="monthly-chart" class="chart-container">
                <!-- Monthly trend chart will be inserted here -->
            </div>
        </div>

        <div class="transactions-table">
            <div class="table-header">
                <h2>Recent Transactions</h2>
                <button id="export-csv" class="btn-secondary">Export to CSV</button>
            </div>
            <div class="table-container">
                <table id="transactions">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="date">Date <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="employee">Employee <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="department">Department <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="merchant">Merchant <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="amount">Amount <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="location">Location <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="status">Status <span class="sort-arrow"></span></th>
                            <th class="sortable" data-sort="type">Type <span class="sort-arrow"></span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Transactions will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Transaction Details Modal -->
    <div id="transaction-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Transaction Details</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Transaction details will be populated here -->
            </div>
        </div>
    </div>

    <div id="loading" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Loading T&E data...</p>
            <small>This may take a few moments</small>
        </div>
    </div>

    <div id="error" class="error-banner hidden">
        <p>Error loading data. Please try again.</p>
    </div>

    <script src="script.js"></script>
</body>
</html>